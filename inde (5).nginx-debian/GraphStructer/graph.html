<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <meta property="og:image" content="https://visualgo.net/img/png/graphds.png">
    <title>图结构</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <link rel="stylesheet" type="text/css" href="common.css">
    <link rel="stylesheet" href="viz-1.0.1.css">
    <link rel="stylesheet" href="visual.css">
    <link rel="stylesheet" href="drawgraph.css">

    <style>
        svg {
            border: 2px solid;
            background-color: #eeeeee;
            cursor: default;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -o-user-select: none;
            user-select: none;
        }

        svg:not(.active):not(.ctrl) {
            cursor: crosshair;
        }

        path.link {
            fill: none;
            stroke: #333;
            stroke-width: 4.3px;
            cursor: default;
        }

        svg:not(.active):not(.ctrl) path.link {
            cursor: pointer;
        }

        path.link.selected {
            stroke-dasharray: 10,2;
        }

        path.link.dragline {
            pointer-events: none;
        }

        path.link.hidden {
            stroke-width: 0;
        }

        circle.node {
            stroke: #333;
            stroke-width: 2px;
            cursor: pointer;
        }

        text {
            font-family: sans-serif;
            font-size: 16px;
            font-weight: bold;
            pointer-events: none;
        }

        text.weight {
            cursor: pointer;
            font-weight: bold;
            text-anchor: middle;
        }

        text.id {
            text-anchor: middle;
            font-weight: bold;
        }

        .tableTitle {
            width: 100%;
            background-color: #009900;
            color: #ffffff;
            font-family: Arial;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
        }

        .graphTable {
            border-collapse: collapse;
            border-spacing: 0;
        }

        .graphTable td {
            border-width: 0px 1px 1px 0px;
            border: 1px solid #000000;
            text-align: center;
            padding : 0;
        }

        .graphTable tr:hover {
            background-color: #ffffff;
        }

        #IsTree, #IsComplete, #IsBipartite, #IsDAG {
            font-family: Arial;
            font-size:14px;
        }

        .bold { font-weight: bold; }
        .red { background-color: red; opacity: 0.3; }
    </style>

</head>

<body>
<div id="top-bar">


    <span id="title">
    <a id='menu1'  class='selected-viz'>Undirected/Unweighted</a>
    <a id='menu2' >U/W</a>
    <a id='menu3' >D/U</a>
    <a id='menu4' >D/W</a>
  </span>
    <div id="mode-menu">
        <div id='mode-button' title='exploration'> &#9663;</div>
        <div id='other-modes'>
            <a title='e-Lecture'></a>
        </div>
    </div>
</div>

<div id="dark-overlay"></div>


<div id="left-bar"></div>
<div id="right-bar"></div>


<div id="overlay" hidden></div>
<div id="dropdown-temp-holder" hidden></div>

<div id="viz">
    <svg width="640" height="360"></svg>
</div>

<table style="width: 600px; margin: auto;">
    <tr>
        <td style="width: 150px; text-align: right;">&bull; Tree? <b><span id="isTree">No</span></b></td>
        <td style="width: 150px; text-align: right;">&bull; Complete? <b><span id="isComplete">No</span></b></td>
        <td style="width: 150px; text-align: right;">&bull; Bipartite? <b><span id="isBipartite">No</span></b></td>
        <td style="width: 150px; text-align: right;">&bull; DAG? <b><span id="isDAG">No</span></b></td>
    </tr>
</table>

<table style="width: 960px; margin: auto;">
    <tr>
        <td style="width: 400px;">
            <div id="adj_matrix" style="float:left; border:0px solid; max-height: 220px; max-width: 390px; overflow: auto; margin-left: 25px;" >
                <div class="tableTitle">Adjacency Matrix</div>
                <table class="graphTable" id="adj_matrix_table" style="width: 390px;">
                    <tbody>
                    <tr><td></td><td class="bold">0</td><td class="bold">1</td><td class="bold">2</td></tr>
                    <tr><td class="bold">0</td><td>0</td><td>1</td><td>0</td></tr>
                    <tr><td class="bold">1</td><td>1</td><td>0</td><td>1</td></tr>
                    <tr><td class="bold">2</td><td>0</td><td>1</td><td>0</td></tr>
                    </tbody>
                </table>
            </div>
        </td>
        <td style="width: 360px;">
            <div id="adj_list" style="float: left; border: 1px solid; max-height: 220px; max-width: 350px;">
                <div class="tableTitle" style="float:left">Adjacency List</div>
                <table class="graphTable" id="adj_list_table" style="width: 350px;">
                    <tbody>
                    <tr><td class="bold">0: </td><td>1</td><td></td></tr>
                    <tr><td class="bold">1: </td><td>0</td><td>2</td></tr>
                    <tr><td class="bold">2: </td><td>1</td><td></td></tr>
                    </tbody>
                </table>
            </div>
        </td>
        <td style="width: 200px;">
            <div id="edge_list" style="float: left; border: 1px solid; max-height: 220px; max-width: 190px; overflow-y: auto;">
                <div class="tableTitle" style="float:left">Edge List</div>
                <table class="graphTable" id="edge_list_table" style="width: 150px;">
                    <tbody>
                    <tr><td class="bold">0: </td><td>0</td><td>1</td></tr>
                    <tr><td class="bold">1: </td><td>1</td><td>2</td></tr>
                    </tbody>
                </table>
            </div>
        </td>
    </tr>
</table>

<div id="actions" class="panel">
    <p onClick="GraphVisu(true , true , 'CP3Fig2.4');">U/U: CP3 Fig 2.4</p>
    <p onClick="GraphVisu(true , true , 'tree');">U/U: Tree</p>


    <p onClick="GraphVisu(true , false, 'CP3Fig4.10');">U/W: CP3 Fig 4.10</p>
    <p onClick="GraphVisu(true , false, 'k5');">U/W: K<sub>5</sub> (Complete)</p>

    <p onClick="GraphVisu(false, true , 'CP3Fig4.4');">D/U: CP3 Fig 4.4</p>
    <p onClick="GraphVisu(false, true , 'cyclic');">D/U: Cyclic</p>

    <p onClick="GraphVisu(false, false, 'CP3Fig4.26B');">D/W: CP3 Fig 4.26B*</p>
    <p onClick="GraphVisu(false, false, 'sssp');">D/W: Four 0&rarr;4 Paths</p>
</div>
<div id="actions-hide" class="panel-hide"><img src="https://visualgo.net/img/arrow_white_right.png" alt=">" title="show/hide actions panel"/></div>

<div id="bottom-bar">
    <a id="trigger-about"></a>
</div>



<script src="jquery-3.1.1.min.js"></script>


<script type="text/javascript">
    var PHP_DOMAIN = "";

    var colourArray = ["#52bc69", "#d65775"/*"#ed5a7d"*/, "#2ebbd1", "#d9513c", "#fec515", "#4b65ba", "#ff8a27", "#a7d41e"]; // green, pink, blue, red, yellow, indigo, orange, lime

    function disableScroll() { $('html').css('overflow', 'hidden'); }

    function enableScroll() { $('html').css('overflow', 'visible'); }

    function replaceAll(find, replace, str) { return str.replace(new RegExp(find, 'g'), replace); }

    function getColours() {
        var generatedColours = new Array();
        while (generatedColours.length < 4) {
            var n = (Math.floor(Math.random() * colourArray.length));
            if ($.inArray(n, generatedColours) == -1)
                generatedColours.push(n);
        }
        return generatedColours;
    }

    function isOn(value, position) {
        return (value>>position) & 1 === 1;
    }

    function customAlert(msg) {
        $('#custom-alert p').html(msg);
        var m = -1 * ($('#custom-alert').outerHeight()/2);
        $('#custom-alert').css('margin-top', m+'px');
        $('#dark-overlay').fadeIn(function() {
            $('#custom-alert').fadeIn(function() {
                setTimeout(function() {
                    $('#custom-alert').fadeOut(function() {
                        $('#dark-overlay').fadeOut();
                    });
                }, 1000);
            });
        });
    }

    function showLoadingScreen() {
        $('#loading-overlay').show();
        $('#loading-message').show();
    }

    function hideLoadingScreen() {
        $('#loading-overlay').hide();
    }

    function commonAction(retval, msg) {
        if (retval) {
            $('#current-action').show();
            $('#current-action').html(mode == "exploration" ? msg : ("e-Lecture Example (auto play until done)<br>" + msg));
            $('#progress-bar').slider("option", "max", gw.getTotalIteration()-1);
            triggerRightPanels();
            isPlaying = true;
        }

    }

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=');
            if (decodeURIComponent(pair[0]) == variable)
                return decodeURIComponent(pair[1]);
        }
        return "";
    }

    var generatedColours = getColours();
    var surpriseColour = colourArray[generatedColours[0]];
    var colourTheSecond = colourArray[generatedColours[1]];
    var colourTheThird = colourArray[generatedColours[2]];
    var colourTheFourth = colourArray[generatedColours[3]];

    $(function() {
        $('.links').css('background', surpriseColour);
        $('.right-links').css('background', surpriseColour);

        $('.colour').css("color", surpriseColour);
        $('h4').css("background-color", surpriseColour);



        $('.close-overlay').click(function() {
            $('.overlays').fadeOut(function() {
                $('#dark-overlay').fadeOut();
            });
        });

        $('#dark-overlay').click(function() {
            $('.overlays').fadeOut();
            $('#dark-overlay').fadeOut();
        });

    });

</script>
<script type="text/javascript" src="jquery-ui.min.js"            ></script>

<script type="text/javascript" src="d3.min.js"></script>
<script type="text/javascript" src="viz-1.0.3.js"></script>
<script type="text/javascript" src="graph_library-1.0.2.min.js"></script>

<script>

    window.onpopstate = function(event) {
        var slide = event.state['slide'];
        openSlide(slide, function() {
            runSlide(slide);
        });
    };

    function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
            sURLVariables = sPageURL.split('&'), sParameterName, i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] === sParam) return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    };

    function pushState(slideValue) {
        var url = '/zh/graphds';
        if (typeof slideValue != 'undefined' && slideValue != null) url += '?slide=' + slideValue;
        window.history.pushState({slide: slideValue}, "slide " + slideValue, url);
    }

    function showPopup(callback) {
        $('#popup').fadeIn(100, callback);
    }

    function hidePopup(callback) {
        $('#popup').fadeOut(100, callback);
    }

    function showOverlay() {
        $('#overlay').css('opacity', 0.5);
        $('#overlay').show();
    }

    function hideOverlay() {
        $('#overlay').hide();
        $("#e-lecture").html("");
    }

    function makeOverlayTransparent() {
        $('#overlay').css('opacity', 0);
    }

    function hideSlide(callback) {
        isPlaying = true;
        closeSlide(cur_slide, function() {
            makeOverlayTransparent();
            setTimeout(callback, 700);
        });
    }

    function showSlide() {
        isPlaying = false;
        openSlide(cur_slide);
        showOverlay();
    }

    $(function() {
        var slide = getUrlParameter('slide');

        $.get('/hasvisited' + '/graphds', function(data) {
            var hasVisited = data['hasvisited'] == '1';
            if (!hasVisited) {
                var postData = {
                    '_token': 'RtB5rTmjBViOzM3blQ0Bk9V6hYMJKZPcKBwuKZsT',
                    'page': '/graphds'.substring(1),
                };

                $.post("/visitpage", postData, function(data) {

                });

                if (typeof slide != undefined && slide != null) {
                    cur_slide = slide;
                }

                $("#mode-menu a").trigger("click");
            }
            else {
                if (typeof slide != undefined && slide != null) {
                    cur_slide = slide;
                    $('#mode-menu a').click();
                }
            }
        }).fail(function() {
            if (typeof slide != undefined && slide != null) {
                cur_slide = slide;
                $('#mode-menu a').click();
            }
        });

        $('.mcq-submit').click(function() {
            var questionId = parseInt($(this).attr('id').split('-')[1]);
            var answer = $('#mcq-answer-' + questionId).val();
            var userAnswer = $('input[type=radio][name=mcq-'+questionId+'-choice]:checked').val();

            if (answer === userAnswer) {
                $('#answer-status-' + questionId).html('<font color="green"><b>Correct!</b></font>');
            }
            else {
                $('#answer-status-' + questionId).html('<font color="red"><b>Wrong Answer! Try again...</b></font>');
            }
            $('#answer-status-' + questionId).show();
            setTimeout(function() {
                $('#answer-status-' + questionId).fadeOut(1000);
            }, 1000);
        });

        $('.msq-submit').click(function() {
            var questionId = parseInt($(this).attr('id').split('-')[1]);
            var answer = $('#msq-answer-' + questionId).val();

            var answers = [];
            $('input[type=checkbox][class=msq-choice]:checked').each(function() {
                answers.push($(this).attr('id').split('-')[3]);
            });
            answers.sort();
            var userAnswer = answers.join(',');

            if (answer === userAnswer) {
                $('#answer-status-' + questionId).html('<font color="green">Correct!</font>');
            }
            else {
                $('#answer-status-' + questionId).html('<font color="red">Wrong Answer! Try again...</font>');
            }
            $('#answer-status-' + questionId).show();
            setTimeout(function() {
                $('#answer-status-' + questionId).fadeOut(1000);
            }, 1000);
        });

        $('select.lecture-dropdown').change(function() {
            var nextSlide = $(this).val();
            openSlide(nextSlide, function() {
                runSlide(nextSlide);
                pushState(nextSlide);
            });
        });

        $('#hide-popup').click(function() {
            hidePopup();
        });

        $('#popup').hover(function() {
            $('#hide-popup').show();
        }, function() {
            $('#hide-popup').hide();
        });



        setTimeout(function(){ document.body.style.zoom = "100.1%"; }, 500);
        setTimeout(function(){ document.body.style.zoom = "100%"; }, 600);
    });


    function adjustPopupToImageSize() {
        var width = $('#popup-image').prop('width');
        var height = $('#popup-image').prop('height');
        $('#popup').width(width + 20);
        $('#popup').height(height + 20);
        if (width == 0 && height == 0) {
            setTimeout(adjustPopupToImageSize, 200);
        } else {
            showPopup();
        }
    }

    function POPUP_IMAGE(url) {
        $('#popup-content').html('<img id="popup-image" src="' + url + '">');
        adjustPopupToImageSize();
    }

    function URL(url) {
        window.open(url, '_blank');
    }
</script>

<script>
    function ENTER_LECTURE_MODE() {}


    function ENTER_EXPLORE_MODE() {}


    function CUSTOM_ACTION(action, data, mode) {}
</script>

<script>
    function toggleActionMenu() {
        $("#actions").toggle();
    }


    var actionsWidth = 140;

    function hideEntireActionsPanel() {
        hideActionsPanel();
    }

    $(function() {
        $("#menu1").on('click', function() {
            GraphVisu(true, true);
        });
        $("#menu2").on('click', function() {
            GraphVisu(true, false);
        });
        $("#menu3").on('click', function() {
            GraphVisu(false, true);
        });
        $("#menu4").on('click', function() {
            GraphVisu(false, false);
        });

        $("#menu1").click();
    });

    function GraphVisu(arg1, arg2, arg3) {
        var menu = (arg1 === false ? 1 : 0) * 2 + (arg2 === false ? 1 : 0) + 1;
        $("#menu1").removeClass('selected-viz');
        $("#menu1").html("U/U");
        $("#menu2").removeClass('selected-viz');
        $("#menu2").html("U/W");
        $("#menu3").removeClass('selected-viz');
        $("#menu3").html("D/U");
        $("#menu4").removeClass('selected-viz');
        $("#menu4").html("D/W");
        $("#menu"+menu.toString()).toggleClass('selected-viz');
        switch (menu) {
            case 1: $("#menu1").html("UNDIRECTED/UNWEIGHTED"); break;
            case 2: $("#menu2").html("UNDIRECTED/WEIGHTED"); break;
            case 3: $("#menu3").html("DIRECTED/UNWEIGHTED"); break;
            case 4: $("#menu4").html("UNDIRECTED/UNWEIGHTED"); break;
        }
        window.scrollTo(0, 100);

        var UNDIRECTED = arg1, UNWEIGHTED = arg2;
        var maxNumberVertex = 10;
        var grid = 20;
        var width = 640, height = 360, colors = d3.scale.category10();


        d3.select("#viz").selectAll('svg').remove();
        var svg = d3.select('#viz')
            .append('svg')
            .attr('width', width)
            .attr('height', height);

        var countNodeId = new Array(maxNumberVertex);
        for (var i = countNodeId.length; i >= 0; i--) countNodeId[i] = 0;

        var nodes = [ {id: 0, x: 160, y: 90  },
            {id: 1, x: 320, y: 180 },
            {id: 2, x: 480, y: 270 } ];
        var lastNodeId = 3;

        var links;
        if (UNWEIGHTED === true)
            links = [ {source: nodes[0], target: nodes[1]},
                {source: nodes[1], target: nodes[2]} ];
        else
            links = [ {source: nodes[0], target: nodes[1], weight: 2},
                {source: nodes[1], target: nodes[2], weight: 2} ];



        if (arg3 === "CP3Fig2.4") {
            nodes = [{id:0,x:220,y:270},{id:1,x:120,y:180},{id:2,x:320,y:180},{id:3,x:120,y:90},{id:4,x:320,y:90},{id:5,x:520,y:90},{id:6,x:520,y:180}];
            links = [{source:{id:0},target:{id:1}},{source:{id:1},target:{id:2}},{source:{id:3},target:{id:1}},{source:{id:3},target:{id:4}},{source:{id:4},target:{id:2}},{source:{id:4},target:{id:5}},{source:{id:5},target:{id:6}},{source:{id:2},target:{id:0}}];
        }
        else if (arg3 === "tree") {
            nodes = [
                {id:0,x:320,y:50},
                {id:1,x:160,y:125},
                {id:2,x:100,y:200},
                {id:3,x:160,y:200},
                {id:4,x:140,y:275},
                {id:5,x:180,y:275},
                {id:6,x:220,y:200},
                {id:7,x:480,y:125},
                {id:8,x:400,y:200},
                {id:9,x:560,y:200}
            ];
            links = [
                {source:{id:0},target:{id:1}},
                {source:{id:1},target:{id:2}},
                {source:{id:1},target:{id:3}},
                {source:{id:3},target:{id:4}},
                {source:{id:3},target:{id:5}},
                {source:{id:1},target:{id:6}},
                {source:{id:0},target:{id:7}},
                {source:{id:7},target:{id:8}},
                {source:{id:7},target:{id:9}}
            ];
        }
        else if (arg3 === "CP3Fig4.10") {
            nodes = [{id:0,x:220,y:130},{id:1,x:320,y:30},{id:2,x:420,y:130},{id:3,x:320,y:230},{id:4,x:220,y:330}];
            links = [{source:{id:0},target:{id:1},weight:"4"},{source:{id:1},target:{id:2},weight:2},{source:{id:2},target:{id:3},weight:"8"},{source:{id:3},target:{id:0},weight:"6"},{source:{id:0},target:{id:2},weight:"4"},{source:{id:3},target:{id:4},weight:"9"},{source:{id:4},target:{id:0},weight:"6"}];
        }
        else if (arg3 === "k5") {
            nodes = [
                {id:0,x:160,y:130},
                {id:1,x:480,y:130},
                {id:2,x:220,y:290},
                {id:3,x:320,y:50},
                {id:4,x:420,y:290}];
            links = [
                {source:{id:0},target:{id:1},weight:"1"},
                {source:{id:1},target:{id:2},weight:"2"},
                {source:{id:2},target:{id:3},weight:"3"},
                {source:{id:3},target:{id:4},weight:"4"},
                {source:{id:4},target:{id:0},weight:"5"},
                {source:{id:0},target:{id:3},weight:"6"},
                {source:{id:3},target:{id:1},weight:"7"},
                {source:{id:1},target:{id:4},weight:"8"},
                {source:{id:4},target:{id:2},weight:"9"},
                {source:{id:2},target:{id:0},weight:"10"}
            ];
        }

        else if (arg3 === "CP3Fig4.4") {
            nodes = [{id:0,x:100,y:100},{id:1,x:210,y:100},{id:2,x:210,y:240},{id:3,x:320,y:100},{id:4,x:430,y:100},{id:5,x:540,y:100},{id:6,x:430,y:240},{id:7,x:540,y:240}];
            links = [{source:{id:0},target:{id:1}},{source:{id:0},target:{id:2}},{source:{id:1},target:{id:2}},{source:{id:7},target:{id:6}},{source:{id:2},target:{id:5}},{source:{id:3},target:{id:4}},{source:{id:1},target:{id:3}},{source:{id:2},target:{id:3}}];
        }
        else if (arg3 === "cyclic") {
            nodes = [
                {id:0,x:120,y:200},
                {id:1,x:320,y:50},
                {id:2,x:520,y:200},
            ];
            links = [
                {source:{id:0},target:{id:1}},
                {source:{id:1},target:{id:2}},
                {source:{id:2},target:{id:0}}
            ];
        }
        else if (arg3 === "CP3Fig4.26B") {
            nodes = [{id:0,x:95,y:180},{id:1,x:245,y:100},{id:2,x:245,y:260},{id:3,x:395,y:260},{id:4,x:545,y:180}];
            links = [{source:{id:0},target:{id:1},weight:"99"},{source:{id:0},target:{id:2},weight:"50"},{source:{id:1},target:{id:2},weight:"50"},{source:{id:1},target:{id:3},weight:"50"},{source:{id:1},target:{id:4},weight:"50"},{source:{id:2},target:{id:3},weight:"99"},{source:{id:3},target:{id:4},weight:"75"}];
        }
        else if (arg3 === "sssp") {
            nodes = [
                {id:0,x:120,y:200},
                {id:1,x:220,y:50},
                {id:2,x:320,y:200},
                {id:3,x:420,y:50},
                {id:4,x:520,y:200},
            ];
            links = [
                {source:{id:0},target:{id:1},weight:"2"},
                {source:{id:0},target:{id:2},weight:"0"},
                {source:{id:1},target:{id:2},weight:"-4"},
                {source:{id:2},target:{id:3},weight:"1"},
                {source:{id:2},target:{id:4},weight:"0"},
                {source:{id:3},target:{id:4},weight:"-2"},
            ];
        }

        lastNodeId = nodes.length;
        for (var i = 0; i < nodes.length; i++) countNodeId[nodes[i].id]++;

        for (var i = 0; i < links.length; i++)
            for (var j = 0; j < nodes.length; j++) {
                if (nodes[j].id === links[i].source.id) links[i].source = nodes[j];
                if (nodes[j].id === links[i].target.id) links[i].target = nodes[j];
            }

        svg.append('svg:defs').append('svg:marker')
            .attr('id', 'end-arrow')
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 6)
            .attr('markerWidth', 3)
            .attr('markerHeight', 3)
            .attr('orient', 'auto')
            .append('svg:path')
            .attr('d', 'M0,-5L10,0L0,5')
            .attr('fill', '#000');

        var drag_line = svg.append('svg:path')
            .attr('class', 'link dragline hidden')
            .attr('d', 'M0,0L0,0');

        var path, circle, weight;
        var selected_node = null,
            selected_link = null,
            mousedown_link = null,
            mousedown_node = null,
            mouseup_node = null;

        function resetMouseVars() {
            mousedown_node = null;
            mouseup_node = null;
            mousedown_link = null;
        }

        function restart() {
            svg.selectAll('g').remove();

            path = svg.append('svg:g').selectAll('path'),
                circle = svg.append('svg:g').selectAll('g');
            weight = svg.append('svg:g').selectAll('text');

            circle = circle.data(nodes, function(d) { return d.id; });
            circle.selectAll('circle').style('fill', function(d) { return (d === selected_node) ? d3.rgb(colors(d.id)).brighter().toString() : colors(d.id); });

            var g = circle.enter().append('svg:g');

            g.append('svg:circle')
                .attr('class', 'node')
                .attr('r', 16)
                .attr('cx', function (d) { return d.x; })
                .attr('cy', function (d) { return d.y; })
                .style('fill', function(d) { return (d === selected_node) ? d3.rgb(255, 138, 39) : d3.rgb(238, 238, 238); })
                .on('mousedown', function(d) {
                    if (d3.event.ctrlKey) return;

                    mousedown_node = d;
                    if (mousedown_node === selected_node) selected_node = null;
                    else selected_node = mousedown_node;

                    selected_link = null;

                    drag_line
                        .style('marker-end', 'url(#end-arrow)')
                        .classed('hidden', false)
                        .attr('d', 'M' + mousedown_node.x + ',' + mousedown_node.y + 'L' + mousedown_node.x + ',' + mousedown_node.y);

                    restart();
                })
                .on('mouseup', function(d) {
                    if (!mousedown_node) return;

                    drag_line
                        .classed('hidden', true)
                        .style('marker-end', '');


                    mouseup_node = d;
                    if (mouseup_node === mousedown_node) { resetMouseVars(); return; }

                    var source, target, direction;

                    source = mousedown_node;
                    target = mouseup_node;

                    var link;

                    if (UNDIRECTED === false) {
                        link = links.filter(function(l) {
                            return (l.source === source && l.target === target);
                        })[0];
                    }
                    else {
                        link = links.filter(function(l) {
                            return (l.source === source && l.target === target) || (l.source === target && l.target === source);
                        })[0];
                    }

                    if (!link) {
                        if (UNWEIGHTED === false) {
                            var dist = parseInt(Math.sqrt(Math.pow(source.x-target.x, 2) + Math.pow(source.y-target.y, 2))/100 + 1);
                            link = {source: source, target: target, weight: dist};
                            links.push(link);
                        }
                        else {
                            link = {source: source, target: target};
                            links.push(link);
                        }
                    }
                    selected_link = link;
                    selected_node = null;
                    restart();
                });

            g.append('svg:text')
                .attr('x', function(d) { return d.x; })
                .attr('y', function(d) { return d.y + 16/3; })
                .attr('class','id')
                .text(function(d) { return d.id; });
            path = path.data(links);

            path.classed('selected', function(d) { return d === selected_link; });

            path.enter().append('svg:path')
                .attr('class','link')
                .classed('selected',function(d) {return d === selected_link; })
                .style('marker-end', function(d) { if (UNDIRECTED === false) return 'url(#end-arrow)';})
                .attr('d', function(d) {
                    var deltaX = d.target.x-d.source.x,
                        deltaY = d.target.y-d.source.y,
                        dist = Math.sqrt(deltaX*deltaX + deltaY*deltaY),
                        normX = deltaX/dist,
                        normY = deltaY/dist,

                        sourcePadding = 12;
                    targetPadding = 17;
                    if (UNDIRECTED === true) targetPadding = 12;
                    sourceX = d.source.x + (sourcePadding*normX),
                        sourceY = d.source.y + (sourcePadding*normY),
                        targetX = d.target.x - (targetPadding*normX),
                        targetY = d.target.y - (targetPadding*normY);

                    if (UNDIRECTED === true)
                        return 'M' + sourceX + ',' + sourceY + 'L' + targetX + ',' + targetY;
                    var link;
                    link = links.filter(function(l) {
                        return (l.source === d.target && l.target === d.source);
                    })[0];

                    if (link) {
                        var type;
                        if (d.source.id < d.target.id) type = 1; else type = 2;
                        var finalX = arrowXY(sourceX, sourceY, targetX, targetY, type).x;
                        var finalY = arrowXY(sourceX, sourceY, targetX, targetY, type).y;

                        var beginX = arrowXY(targetX, targetY, sourceX, sourceY, type).x;
                        var beginY = arrowXY(targetX, targetY, sourceX, sourceY, type).y;
                        return 'M' + beginX + ',' + beginY + 'L' + finalX + ',' + finalY;
                    }
                    else
                        return 'M' + sourceX + ',' + sourceY + 'L' + targetX + ',' + targetY;
                })
                .on('mousedown', function(d) {
                    if(d3.event.ctrlKey) return;
                    mousedown_link = d;
                    if(mousedown_link === selected_link) selected_link = null;
                    else selected_link = mousedown_link;
                    selected_node = null;
                    restart();
                });

            if (UNWEIGHTED === false) {
                weight = weight.data(links);

                weight.enter().append('svg:text')
                    .attr('class','weight')
                    .attr('x', function(d) {
                        var type;
                        if (d.source.id < d.target.id) type = 1; else type = 2;

                        var link;
                        link = links.filter(function(l) {
                            return (l.source === d.target && l.target === d.source);
                        })[0];

                        var curve = 0;
                        if (link) curve = 2;

                        var x = weightXY(d.source.x, d.source.y, d.target.x, d.target.y, type, curve).x;
                        return x;
                    })
                    .attr('y', function(d) {
                        var type;
                        if (d.source.id < d.target.id) type = 1; else type = 2;

                        var link;
                        link = links.filter(function(l) {
                            return (l.source === d.target && l.target === d.source);
                        })[0];

                        var curve = 0;
                        if (link) curve = 2;

                        var y = weightXY(d.source.x, d.source.y, d.target.x, d.target.y, type, curve).y;
                        return y;
                    })
                    .text(function(d) { return d.weight; });
            }

            var maxNodeId = -1;
            var countNode = nodes.length;
            var countEdge = links.length;
            var adjMat = [];
            var M = [];

            for (var i = 0; i < nodes.length; i++)
                if (nodes[i].id > maxNodeId)
                    maxNodeId = nodes[i].id;

            maxNodeId++;
            var validNode = new Array(maxNodeId);

            for (var i = 0; i < maxNodeId; i++) validNode[i] = false;
            for (var i = 0; i < nodes.length; i++) validNode[nodes[i].id] = true;

            for (var i = 0; i < maxNodeId; i++) {
                adjMat[i] = [];
                M[i] = [];
                for (var j = 0; j < maxNodeId; j++)
                    if (validNode[i] === true && validNode[j] === true) {
                        adjMat[i][j] = "0";
                        M[i][j] = 0;
                    }
                    else {
                        adjMat[i][j] = "x";
                        M[i][j] = -1;
                    }
                M[i][i] = 0;
            }

            if (UNDIRECTED === true) {
                if (UNWEIGHTED === true) {
                    for (var i = 0; i < links.length; i++) {
                        adjMat[links[i].source.id][links[i].target.id] = "1";
                        adjMat[links[i].target.id][links[i].source.id] = "1";
                        M[links[i].source.id][links[i].target.id] = 1;
                        M[links[i].target.id][links[i].source.id] = 1;
                    }
                }
                else {
                    for (var i = 0; i < links.length; i++) {
                        adjMat[links[i].source.id][links[i].target.id] = links[i].weight.toString();
                        adjMat[links[i].target.id][links[i].source.id] = links[i].weight.toString();
                        M[links[i].source.id][links[i].target.id] = 1;
                        M[links[i].target.id][links[i].source.id] = 1;
                    }
                }
            }
            else {
                if (UNWEIGHTED === true) {
                    for (var i = 0; i < links.length; i++) {
                        adjMat[links[i].source.id][links[i].target.id] = "1";
                        M[links[i].source.id][links[i].target.id] = 1;
                    }
                }
                else {
                    for (var i = 0; i < links.length; i++) {
                        adjMat[links[i].source.id][links[i].target.id] = links[i].weight.toString();
                        M[links[i].source.id][links[i].target.id] = 1;
                    }
                }
            }
            d3.select("#adj_matrix_table").selectAll('tr').remove();
            var table1 = d3.select("#adj_matrix_table").select('tbody');
            var row = table1.append('tr');
            row.append('td').text(" ");

            for (var i = 0; i < maxNodeId; i++) row.append('td').text(i.toString()).attr('class','bold');

            for (var i = 0; i < maxNodeId; i++) {
                row = table1.append('tr');
                row.append('td').text(i.toString()).attr('class', 'bold');
                for (var j = 0; j < maxNodeId; j++) {
                    if (adjMat[i][j] == "0") row.append('td').text(adjMat[i][j]).attr('class', 'red');
                    else                     row.append('td').text(adjMat[i][j]);
                }
            }

            d3.select("#adj_list_table").selectAll('tr').remove();
            var table2 = d3.select("#adj_list_table").select('tbody');

            for (var i = 0; i < maxNodeId; i++) {
                row = table2.append('tr');
                row.append('td').text(i.toString() + ": ").attr('class', 'bold');
                if (UNWEIGHTED === true) {
                    for (var j = 0; j < maxNodeId; j++)
                        if (adjMat[i][j] == "1")
                            row.append('td').text(j);
                }
                else {
                    for (var j = 0; j < maxNodeId; j++)
                        if ((adjMat[i][j] != "0") && (adjMat[i][j] != "x"))
                            row.append('td').text("(" + j + ", " + adjMat[i][j] + ")");
                }
            }

            d3.select("#edge_list_table").selectAll('tr').remove();
            var table3 = d3.select("#edge_list_table").select('tbody');

            var counter = 0;
            for (var i = 0; i < maxNodeId; i++) {
                var start_j = 0;
                if (UNDIRECTED === true) start_j = i+1;
                for (var j = start_j; j < maxNodeId; j++)
                    if ((adjMat[i][j] != "0") && (adjMat[i][j] != "x")) {
                        row = table3.append('tr');
                        row.append('td').text(counter.toString() + ": ").attr('class', 'bold');
                        counter++;
                        row.append('td').text(i);
                        row.append('td').text(j);
                        if (UNWEIGHTED === false)
                            row.append('td').text(adjMat[i][j]);
                    }
            }

            var visited = new Array(10, false);

            function dfs(u) {
                visited[u] = true;
                for (var k = 0; k < nodes.length; k++)
                    if ((adjMat[u][k] != "0") && (adjMat[u][k] != "x") && (visited[k] === false))
                        dfs(k);
            }
            if (UNDIRECTED === true) {
                var IsTree = (countEdge === countNode-1);
                visited = new Array(10, false);
                for (var i = 0; i < nodes.length; i++) visited[i] = false;
                dfs(0);
                for (var i = 0; i < nodes.length; i++)
                    if (visited[i] === false) {
                        IsTree = false;
                        break;
                    }

                if (IsTree)
                    $("#isTree").text("Yes");
                else
                    $("#isTree").text("No");
            }
            else
                $("#isTree").text("Undefined");
            if (UNDIRECTED === true) {
                if (countEdge === (countNode * (countNode-1)) / 2)
                    $("#isComplete").text("Yes");
                else
                    $("#isComplete").text("No");
            }
            else {
                if (countEdge === countNode * (countNode-1))
                    $("#isComplete").text("Yes");
                else
                    $("#isComplete").text("No");
            }

            if (UNDIRECTED === true) {
                var color = [];
                for (var i = 0; i < maxNodeId; i++) color[i] = -1;

                var IsBipartite = true;
                if (countNode === 0)
                    IsBipartite = false;
                else {
                    var q = [];
                    q.push(nodes[0].id);
                    while (q.length > 0) {
                        var u = q.shift();
                        for (var v = 0; v < maxNodeId; v++)
                            if ((adjMat[u][v] != "0") && (adjMat[u][v] != "x")) {
                                if (color[v] === -1) {
                                    color[v] = 1-color[u];
                                    q.push(v);
                                }
                                else if (color[v] === color[u]) {
                                    IsBipartite = false;
                                    break;
                                }
                            }

                        if (IsBipartite === false) break;
                    }
                }

                if (IsBipartite === true)
                    $("#isBipartite").text("Yes");
                else
                    $("#isBipartite").text("No");
            }
            else
                $("#isBipartite").text("Undefined");


            var IsDAG = true;
            if (UNDIRECTED === true)
                IsDAG = false;
            else {
                for (var k = 0; k < nodes.length; k++)
                    for (var i = 0; i < nodes.length; i++)
                        for (var j = 0; j < nodes.length; j++)
                            if ((M[i][k] == 1) && (M[k][j] == 1))
                                M[i][j] = 1;

                for (var i = 0; i < nodes.length; i++)
                    if (M[i][i] == 1)
                        IsDAG = false;
            }

            if (IsDAG === true)
                $("#isDAG").text("Yes");
            else
                $("#isDAG").text("No");
        }
        function arrowXY(x1, y1, x2, y2, t) {
            var dist = Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));

            if (x1 === x2) {
                if (t === 1) return {x: x2-4, y: y2};
                else         return {x: x2+4, y: y2};
            }

            if (y1 === y2) {
                if (t === 1) return {x: x2, y: y2-4};
                else         return {x: x2, y: y2+4};
            }

            var m1 = (y2 - y1)/(x2-x1);
            var c1 = y1 - m1*x1;
            var m2 = -1 / m1;
            var c2 = y2 - m2*x2;
            var d = Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));

            var v = 4;
            d = d*d + v*v;
            var D = d;
            var z1 = c2 - y1;

            var a = 1 + m2*m2;
            var b = 2*m2*z1 - 2*x1;
            var c = x1*x1 + z1*z1 - D;

            var delta = b*b - 4*a*c;

            delta = Math.sqrt(delta);

            var x_1 = (-b+delta)/(2*a);
            var y_1 = m2*x_1 + c2;

            var x_2 = (-b-delta)/(2*a);
            var y_2 = m2*x_2 + c2;

            if (t === 2) return {x : x_1, y: y_1};
            else         return {x : x_2, y: y_2};
        }

        function weightXY(x1, y1, x2, y2, t, curve) {
            var dist = Math.sqrt(Math.pow(x2-x1, 2) + Math.pow(y2-y1, 2));

            var x2 = (x1+x2)/2;
            var y2 = (y1+y2)/2;

            if (x1 === x2) {
                if (t === 2) return {x: x2+16, y: y2};
                else         return {x: x2-16, y: y2};
            }

            if (y1 === y2) {
                if (t === 2) return {x: x2 , y: y2+16};
                else         return {x: x2, y: y2-16};
            }

            var m1 = (y2 - y1)/(x2-x1);
            var c1 = y1 - m1*x1;
            var m2 = -1 / m1;
            var c2 = y2 - m2*x2;
            var d = Math.sqrt(Math.pow(x2-x1,2) + Math.pow(y2-y1,2));

            var v = 16;
            if (curve === 1) v = 50;
            if (curve === 2) v = 18;

            d = d*d + v*v;
            var D = d;
            var z1 = c2 - y1;

            var a = 1 + m2*m2;
            var b = 2*m2*z1 - 2*x1;
            var c = x1*x1 + z1*z1 - D;

            var delta = b*b - 4*a*c;

            delta = Math.sqrt(delta);

            var x_1 = (-b+delta)/(2*a);
            var y_1 = m2*x_1 + c2;

            var x_2 = (-b-delta)/(2*a);
            var y_2 = m2*x_2 + c2;

            if (t === 2) return {x : x_1, y: y_1};
            else return {x : x_2, y: y_2};
        }

        function mousedown() {
            svg.classed('active', true);
            if (d3.event.ctrlKey || mousedown_node || mousedown_link) return;

            if (nodes.length === 10) {
                restart();
                svg.append('svg:g').append('svg:text')
                    .attr('x', 10)
                    .attr('y', 20)
                    .text('Sorry, you cannot have more than 10 vertices in this visualization...');
                return;
            }

            var point = d3.mouse(this), node = {id: lastNodeId};
            countNodeId[lastNodeId]++;
            for (var i = 0; i < maxNumberVertex; i++)
                if (countNodeId[i] === 0) {
                    lastNodeId = i;
                    break;
                }
            node.x = point[0];
            node.y = point[1];

            node.x = parseInt(node.x) - parseInt(node.x) % grid;
            node.y = parseInt(node.y) - parseInt(node.y) % grid;

            nodes.push(node);
            restart();
        }

        function mousemove() {
            if (!mousedown_node) return;
            drag_line.attr('d', 'M' + mousedown_node.x + ',' + mousedown_node.y + 'L' + d3.mouse(this)[0] + ',' + d3.mouse(this)[1]);
            restart();
        }

        function mouseup() {
            if (mousedown_node) drag_line.classed('hidden', true);
            svg.classed('active', false);
            resetMouseVars();
        }

        function spliceLinksForNode(node) {
            var toSplice = links.filter(function(l) {
                return (l.source === node || l.target === node);
            });
            toSplice.map(function(l) {
                links.splice(links.indexOf(l), 1);
            });
        }
        var lastKeyDown = -1;

        var drag = d3.behavior.drag()
            .on("drag", function (d) {
                var dragTarget = d3.select(this).select('circle');
                var new_cx, new_cy;

                dragTarget
                    .attr("cx", function() {
                        new_cx = d3.mouse($("svg")[0])[0];
                        return new_cx;
                    })
                    .attr("cy", function() {
                        new_cy = d3.mouse($("svg")[0])[1];
                        return new_cy;
                    });

                d.x = new_cx;
                d.y = new_cy;

                d.x = parseInt(d.x)-parseInt(d.x) % grid;
                d.y = parseInt(d.y)-parseInt(d.y) % grid;

                restart();
            });

        function keydown() {
            lastKeyDown = d3.event.keyCode;

            if (d3.event.keyCode === 17) {
                circle.call(drag);
                svg.classed('ctrl', true);
            }

            if (!selected_node && !selected_link) return;

            switch (d3.event.keyCode) {
                case 46:
                    if (selected_node) {
                        nodes.splice(nodes.indexOf(selected_node), 1);
                        spliceLinksForNode(selected_node);
                        countNodeId[selected_node.id] = 0;
                        for (var i = 0; i < maxNumberVertex; i++)
                            if (countNodeId[i] === 0) {
                                lastNodeId = i;
                                break;
                            }
                    }
                    else if (selected_link)
                        links.splice(links.indexOf(selected_link), 1);
                    selected_link = null;
                    selected_node = null;
                    restart();
                    break;
                case 13:
                    if (selected_link && UNWEIGHTED === false) {
                        while (true) {
                            var newWeight = prompt('Enter new weight: (&le; 99)');
                            if (newWeight <= 99) break;
                        }
                        var idx = links.indexOf(selected_link);
                        links[idx].weight = newWeight;
                    }
                    restart();
                    break;
            }
        }

        function keyup() {
            lastKeyDown = -1;
            if (d3.event.keyCode === 17) {
                circle.on('mousedown.drag', null)
                    .on('touchstart.drag', null);
                svg.classed('ctrl', false);
            }
        }

        svg.on('mousedown', mousedown)
            .on('mousemove', mousemove)
            .on('mouseup', mouseup);
        d3.select(window)
            .on('keydown',keydown)
            .on('keyup',keyup);
        restart();
    }
</script>

</body>
</html>
